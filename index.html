<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BearStrike - FPS Online</title>
    <link rel="icon" type="image/png" href="logo de la pagina/LOGO_FINAL.png">
    <link rel="shortcut icon" type="image/png" href="logo de la pagina/LOGO_FINAL.png">
    
    <!-- Lucide Icons - Iconos modernos para gaming -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" defer></script>
    
    <link rel="stylesheet" href="css/estilos.css?v=20260105c" />
    
    <!-- Lucide Icons para iconos SVG profesionales -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- Import map para resolver m√≥dulos de npm en el navegador -->
    <script type="importmap">
      {
        "imports": {
          "@dimforge/rapier3d-compat": "https://cdn.jsdelivr.net/npm/@dimforge/rapier3d-compat@0.14.0/+esm"
        }
      }
    </script>
  </head>
  <body>
    <!-- ==================== LOBBY SCREEN ==================== -->
    <div id="lobby-screen">
      <!-- Pantalla Inicial del Lobby - Dise√±o Minimalista -->
      <div id="lobby-inicial" class="lobby-pantalla active">
        <div class="lobby-minimal">
          <!-- Contenido central -->
          <div class="lobby-center">
            <!-- T√≠tulo del juego -->
            <h1 class="game-title">BEARSTRIKE</h1>
            
            <!-- Nickname con avatar -->
            <div class="nickname-section">
              <div class="nickname-input-group">
                <div class="avatar-minimal"><span><i data-lucide="user"></i></span></div>
                <input type="text" id="nombre-jugador" placeholder="Ingresa tu nickname..." maxlength="16" class="nickname-input">
                <button id="btn-nombre-aleatorio" class="random-btn" title="Nickname aleatorio"><i data-lucide="dice-6"></i></button>
              </div>
              <span id="nombre-error" class="error-minimal"></span>
            </div>
            
            <!-- Botones de juego -->
            <div class="game-buttons">
              <button id="btn-modo-online" class="game-btn primary-btn">
                <span class="btn-icon-game"><i data-lucide="globe"></i></span>
                <div class="btn-content-game">
                  <span class="btn-title-game">Jugar Online</span>
                  <span class="btn-subtitle-game">Multijugador</span>
                </div>
              </button>
              <button id="btn-modo-local" class="game-btn secondary-btn">
                <span class="btn-icon-game"><i data-lucide="gamepad-2"></i></span>
                <div class="btn-content-game">
                  <span class="btn-title-game">Modo Local</span>
                  <span class="btn-subtitle-game">Pr√°ctica</span>
                </div>
              </button>
            </div>
          </div>
          
          <!-- Opciones en la esquina superior derecha -->
          <div class="corner-options">
            <button id="lobby-login-btn" class="login-btn-corner"><span><i data-lucide="log-in"></i></span> Iniciar Sesi√≥n</button>
            <button id="btn-config-lobby" class="corner-btn"><span><i data-lucide="settings"></i></span></button>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Selecci√≥n Online -->
      <div id="lobby-online" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-inicial" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Modo Online</h2>
            </div>
            
            <span id="online-error" class="error-mensaje centro"></span>
            
            <div class="lobby-botones">
              <button id="btn-partida-publica" class="lobby-btn btn-primario">
                <span class="btn-icono-grande"><i data-lucide="unlock"></i></span>
                <span class="btn-texto">
                  <span class="btn-titulo">Partida P√∫blica</span>
                  <span class="btn-desc">Matchmaking autom√°tico</span>
                </span>
              </button>
              <button id="btn-partida-privada" class="lobby-btn btn-secundario">
                <span class="btn-icono-grande"><i data-lucide="lock"></i></span>
                <span class="btn-texto">
                  <span class="btn-titulo">Partida Privada</span>
                  <span class="btn-desc">Juega con amigos</span>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Pantalla de Opciones Partida Privada -->
      <div id="lobby-privada" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-online" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Partida Privada</h2>
            </div>
            
            <div class="lobby-botones">
              <button id="btn-crear-partida" class="lobby-btn btn-primario">
                <span class="btn-icono-grande"><i data-lucide="plus"></i></span>
                <span class="btn-texto">
                  <span class="btn-titulo">Crear Partida</span>
                  <span class="btn-desc">Crea una sala nueva</span>
                </span>
              </button>
              <button id="btn-unirse-partida" class="lobby-btn btn-secundario">
                <span class="btn-icono-grande"><i data-lucide="door-open"></i></span>
                <span class="btn-texto">
                  <span class="btn-titulo">Unirse a Partida</span>
                  <span class="btn-desc">Ingresa c√≥digo de sala</span>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Crear Partida Privada -->
      <div id="lobby-crear" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-privada-crear" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Crear Partida</h2>
            </div>
            
            <div class="lobby-seccion">
              <label for="crear-password">Contrase√±a de la Sala</label>
              <input type="password" id="crear-password" placeholder="4-20 caracteres" maxlength="20">
              <span id="crear-password-error" class="error-mensaje"></span>
            </div>
            
            <button id="btn-confirmar-crear" class="lobby-btn btn-primario btn-full">
              <span><i data-lucide="target"></i></span> Crear Partida
            </button>
            
            <span id="crear-error" class="error-mensaje centro"></span>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Unirse a Partida -->
      <div id="lobby-unirse" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-privada-unirse" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Unirse a Partida</h2>
            </div>
            
            <div class="lobby-seccion">
              <label for="unirse-codigo">C√≥digo de Sala</label>
              <input type="text" id="unirse-codigo" placeholder="Ej: ABC123" maxlength="6" style="text-transform: uppercase;">
            </div>
          
            <div class="lobby-seccion">
              <label for="unirse-password">Contrase√±a</label>
              <input type="password" id="unirse-password" placeholder="Contrase√±a de la sala" maxlength="20">
            </div>
            
            <button id="btn-confirmar-unirse" class="lobby-btn btn-primario btn-full">
              <span><i data-lucide="rocket"></i></span> Unirse
            </button>
            
            <span id="unirse-error" class="error-mensaje centro"></span>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Matchmaking -->
      <div id="lobby-matchmaking" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-cancelar-matchmaking" class="btn-volver">‚Üê Cancelar</button>
              <h2 class="lobby-subtitulo">Buscando Partida</h2>
            </div>
            
            <div class="matchmaking-contenido">
              <div class="matchmaking-spinner"></div>
              <p class="matchmaking-texto" id="matchmaking-estado">Buscando partida...</p>
              <p class="matchmaking-subtexto">Esto puede tomar unos segundos</p>
            </div>
            
            <span id="matchmaking-error" class="error-mensaje centro"></span>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Sala Creada (Esperando) -->
      <div id="lobby-esperando" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-salir-sala" class="btn-volver">‚Üê Salir</button>
              <h2 class="lobby-subtitulo">Sala Creada</h2>
            </div>
            
            <div class="sala-info">
              <p class="sala-label">C√≥digo de Sala:</p>
              <div class="sala-codigo-container">
                <span id="sala-codigo" class="sala-codigo">------</span>
                <button id="btn-copiar-codigo" class="btn-copiar" title="Copiar c√≥digo">üìã</button>
              </div>
              <p class="sala-hint">Comparte este c√≥digo con tus amigos</p>
            </div>
            
            <div class="sala-jugadores">
              <p class="sala-label">Jugadores: <span id="sala-jugadores-count">1</span>/8</p>
              <div id="sala-jugadores-lista" class="jugadores-lista">
                <!-- Lista de jugadores se llena din√°micamente -->
              </div>
            </div>
            
            <button id="btn-iniciar-partida" class="lobby-btn btn-primario btn-full">
              <span><i data-lucide="play"></i></span> Iniciar Partida
            </button>
          </div>
        </div>
      </div>
      
      <!-- Panel de Configuraci√≥n del Lobby -->
      <div id="lobby-config" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-config" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Configuraci√≥n</h2>
            </div>
            
            <div class="config-lista">
              <div class="config-item">
                <label>Sensibilidad</label>
                <div class="config-control">
                  <input type="range" id="lobby-sensibilidad" min="0.001" max="0.01" step="0.001" value="0.002">
                  <span id="lobby-sensibilidad-valor">0.002</span>
                </div>
              </div>
              
              <div class="config-item">
                <label>Volumen</label>
                <div class="config-control">
                  <input type="range" id="lobby-volumen" min="0" max="1" step="0.1" value="0.5">
                  <span id="lobby-volumen-valor">50%</span>
                </div>
              </div>
              
              <div class="config-item">
                <label>Mostrar FPS</label>
                <input type="checkbox" id="lobby-mostrar-fps">
              </div>
              
              <div class="config-item">
                <label>Crosshair Din√°mico</label>
                <input type="checkbox" id="lobby-crosshair-dinamico" checked>
              </div>
            </div>
            
            <button id="btn-guardar-config" class="lobby-btn btn-primario btn-full">
              <span><i data-lucide="save"></i></span> Guardar Configuraci√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ==================== FIN LOBBY SCREEN ==================== -->

    <!-- Pantalla de carga -->
    <div id="loading-screen">
      <div class="loading-content">
        <div class="loading-title">CARGANDO</div>
        <div class="loading-bar-container">
          <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-text" id="loading-text">Iniciando...</div>
      </div>
    </div>

    <!-- Controles ocultos - ver en men√∫ ESC -->
    <div id="info" style="display: none;">
      <div>WASD - Movimiento</div>
      <div>Mouse - Mirar alrededor</div>
      <div>Clic Izquierdo - Disparar</div>
      <div>Clic Derecho - Apuntar</div>
      <div>Espacio - Saltar</div>
      <div>R - Recargar</div>
      <div>E - Dash</div>
      <div>Q / Rueda Mouse - Cambiar arma</div>
      <div>1-8 - Seleccionar arma</div>
    </div>
    <div id="crosshair"></div>
    <div id="aim-indicator">APUNTANDO</div>
    
    <!-- Weapon info con slots intercambiables -->
    <!-- Requirements: 4.3, 4.4, 4.5 - UI de munici√≥n con slots intercambiables -->
    
    <!-- Men√∫ de armas para modo local (arriba del weapon info) -->
    <div id="weapon-selector-local" class="weapon-selector-local hidden">
      <div class="weapon-selector-grid">
        <!-- Las armas se generar√°n din√°micamente aqu√≠ -->
      </div>
    </div>
    
    <!-- Panel superior izquierdo: Dash_Box | Heal_Box -->
    <!-- Requirements: 4.1, 5.1 - Cuadros de acci√≥n en esquina inferior izquierda -->
    <div id="top-left-panel">
      <!-- Dash Box - Cuadro de dash con circunferencia SVG, icono zap y tecla E -->
      <!-- Requirements: 4.1, 4.2, 4.3, 4.4 -->
      <div id="dash-box" class="action-box">
        <!-- Dash Circle - Circunferencia con n√∫mero de cargas -->
        <div id="dash-circle">
          <svg class="dash-circle-svg" viewBox="0 0 36 36">
            <circle class="dash-circle-bg" cx="18" cy="18" r="15.5" />
            <circle class="dash-circle-progress" cx="18" cy="18" r="15.5" />
          </svg>
          <span class="dash-circle-number">3</span>
        </div>
        <i data-lucide="zap" class="action-icon"></i>
        <span class="action-key">E</span>
      </div>
      
      <!-- Heal Box - Cuadro de curaci√≥n con icono heart y tecla C -->
      <!-- Requirements: 5.1, 5.2, 5.3 -->
      <div id="heal-box" class="action-box">
        <i data-lucide="heart" class="action-icon"></i>
        <span class="action-key">C</span>
      </div>
    </div>
    
    <!-- Panel inferior derecho: Weapon_Info -->
    <!-- Requirements: 9.1, 9.2 - Informaci√≥n del arma en esquina inferior derecha -->
    <div id="bottom-right-panel">
      <!-- Weapon Info - Panel de informaci√≥n del arma -->
      <!-- Requirements: 7.1, 7.2 -->
      <div id="weapon-info">
        <!-- Slot superior: arma secundaria con indicador [Q] -->
        <div id="weapon-slot-superior" class="weapon-slot secundario">
          <span class="slot-nombre">Cuchillo</span>
          <span class="slot-tecla">[Q]</span>
        </div>
        <!-- Slot inferior: arma equipada con munici√≥n -->
        <div id="weapon-slot-inferior" class="weapon-slot principal">
          <div id="weapon-name">M4A1</div>
          <div id="ammo">30 / 120</div>
        </div>
      </div>
    </div>
    
    <div id="damage-indicator"></div>
    
    <!-- Death screen overlay with weapon selection -->
    <!-- Requirements: 3.1, 3.2, 3.4 - Pantalla de muerte con men√∫ de selecci√≥n de armas -->
    <div id="death-screen" class="hidden">
      <div class="death-content">
        <div class="death-title">ELIMINADO</div>
        <div class="death-killer">por <span id="killer-name">Jugador</span></div>
        
        <!-- Contenedor para el men√∫ de selecci√≥n de armas en muerte -->
        <div id="death-weapon-selection" class="death-weapon-selection">
          <!-- El men√∫ de selecci√≥n de armas se insertar√° aqu√≠ din√°micamente -->
        </div>
        
        <div class="respawn-countdown">Reapareciendo en <span id="respawn-timer">5</span>s</div>
        
        <!-- Bot√≥n de reaparecer (se habilita despu√©s del timer) -->
        <button id="btn-reaparecer" class="btn-reaparecer disabled" disabled>
          <span class="btn-reaparecer-icono">üîÑ</span>
          <span class="btn-reaparecer-texto">Reaparecer</span>
        </button>
      </div>
    </div>
    
    <!-- Kill feed -->
    <div id="kill-feed"></div>
    
    <!-- Player Status Panel - Unified health and dash -->
    <!-- Requirements: 2.1, 3.1 - Panel integrado de vida en esquina inferior izquierda -->
    <div id="player-status-panel">
      <div id="health-bar-container">
        <div id="health-bar"></div>
        <div id="health-text">200 / 200</div>
      </div>
      <!-- Old dash-charges removed - now using dash-box in bottom-right-panel -->
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu" class="hidden">
      <div class="pause-overlay"></div>
      <div class="pause-content">
        <div class="pause-buttons">
          <button id="resume-btn" class="pause-btn primary">
            <span class="btn-icon"><i data-lucide="play"></i></span>
            Continuar
          </button>
          
          <button id="settings-btn" class="pause-btn">
            <span class="btn-icon"><i data-lucide="settings"></i></span>
            Configuraci√≥n
          </button>
          
          <button id="controls-btn" class="pause-btn">
            <span class="btn-icon"><i data-lucide="gamepad-2"></i></span>
            Controles
          </button>
          
          <button id="stats-btn" class="pause-btn">
            <span class="btn-icon"><i data-lucide="bar-chart-3"></i></span>
            Estad√≠sticas
          </button>
          
          <button id="exit-btn" class="pause-btn danger">
            <span class="btn-icon"><i data-lucide="door-open"></i></span>
            Salir
          </button>
        </div>
        
        <!-- Settings Panel -->
        <div id="settings-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="settings-back-btn" class="back-btn">‚Üê</button>
            <h3>Configuraci√≥n</h3>
          </div>
          <div class="settings-grid">
            <div class="setting-item">
              <label>Sensibilidad</label>
              <input type="range" id="mouse-sensitivity" min="0.001" max="0.01" step="0.001" value="0.002">
              <span id="sensitivity-value">0.002</span>
            </div>
            <div class="setting-item">
              <label>Volumen</label>
              <input type="range" id="master-volume" min="0" max="1" step="0.1" value="0.5">
              <span id="volume-value">50%</span>
            </div>
            <div class="setting-item">
              <label>Mostrar FPS</label>
              <input type="checkbox" id="show-fps">
            </div>
            <div class="setting-item">
              <label>Crosshair Din√°mico</label>
              <input type="checkbox" id="dynamic-crosshair" checked>
            </div>
          </div>
        </div>
        
        <!-- Controls Panel -->
        <div id="controls-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="controls-back-btn" class="back-btn">‚Üê</button>
            <h3>Controles</h3>
          </div>
          <div class="controls-list">
            <div class="control-item"><span>Mover</span><kbd>WASD</kbd></div>
            <div class="control-item"><span>Saltar</span><kbd>SPACE</kbd></div>
            <div class="control-item"><span>Dash</span><kbd>E</kbd></div>
            <div class="control-item"><span>Disparar</span><kbd>CLICK</kbd></div>
            <div class="control-item"><span>Apuntar</span><kbd>RMB</kbd></div>
            <div class="control-item"><span>Recargar</span><kbd>R</kbd></div>
          </div>
        </div>
        
        <!-- Stats Panel -->
        <div id="stats-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="stats-back-btn" class="back-btn">‚Üê</button>
            <h3>Estad√≠sticas</h3>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="kills-stat">0</div>
              <div class="stat-label">Kills</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="deaths-stat">0</div>
              <div class="stat-label">Muertes</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="kd-ratio">0.00</div>
              <div class="stat-label">K/D</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="shots-fired">0</div>
              <div class="stat-label">Disparos</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Auth UI Overlay - Opcional -->
    <div id="auth-overlay" class="auth-overlay hidden">
      <div class="auth-container">
        <div class="auth-header">
          <h2 id="auth-title">Iniciar Sesi√≥n</h2>
          <button id="auth-close" class="auth-close">&times;</button>
        </div>
        
        <!-- Login Form -->
        <form id="login-form" class="auth-form">
          <div class="form-group">
            <label for="login-username">Usuario o Email</label>
            <input type="text" id="login-username" required>
          </div>
          <div class="form-group">
            <label for="login-password">Contrase√±a</label>
            <input type="password" id="login-password" required>
          </div>
          <button type="submit" class="auth-btn primary">Iniciar Sesi√≥n</button>
          <p class="auth-switch">
            ¬øNo tienes cuenta? <a href="#" id="show-register">Reg√≠strate</a>
          </p>
        </form>
        
        <!-- Register Form -->
        <form id="register-form" class="auth-form hidden">
          <div class="form-group">
            <label for="register-username">Nombre de Usuario</label>
            <input type="text" id="register-username" required>
          </div>
          <div class="form-group">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" required>
          </div>
          <div class="form-group">
            <label for="register-password">Contrase√±a</label>
            <input type="password" id="register-password" required>
          </div>
          <div class="form-group">
            <label for="register-confirm">Confirmar Contrase√±a</label>
            <input type="password" id="register-confirm" required>
          </div>
          <button type="submit" class="auth-btn primary">Registrarse</button>
          <p class="auth-switch">
            ¬øYa tienes cuenta? <a href="#" id="show-login">Inicia Sesi√≥n</a>
          </p>
        </form>
        
        <div id="auth-error" class="auth-error hidden"></div>
        <div id="auth-loading" class="auth-loading hidden">Cargando...</div>
      </div>
    </div>

    <!-- User Menu Overlay -->
    <div id="user-menu-overlay" class="user-menu-overlay hidden">
      <div id="user-menu-container" class="user-menu-container">
        <!-- Header -->
        <div class="user-menu-header">
          <h2>Mi Personaje</h2>
          <button id="user-menu-close" class="user-menu-close">&times;</button>
        </div>
        
        <!-- Main Content -->
        <div class="user-menu-content">
          <!-- 3D Character Display -->
          <div id="user-menu-canvas" class="user-menu-canvas"></div>
          
          <!-- Weapon Info -->
          <div id="user-menu-weapon-info" class="user-menu-weapon-info">
            <h3 id="user-menu-weapon-name">M4A1</h3>
            <p id="user-menu-weapon-desc">Rifle de asalto vers√°til con buen equilibrio entre da√±o y precisi√≥n</p>
          </div>
          
          <!-- User Stats -->
          <div id="user-menu-stats" class="user-menu-stats">
            <!-- Stats se llenan din√°micamente -->
          </div>
        </div>
        
        <!-- Weapon Selector -->
        <div id="user-menu-weapon-selector" class="user-menu-weapon-selector">
          <!-- Botones de armas se crean din√°micamente -->
        </div>
      </div>
    </div>

    <!-- Librer√≠as externas de Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.4/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <!-- Configuraci√≥n del juego -->
    <script type="module" src="configuracion-juego.js"></script>

    <!-- Punto de entrada principal del juego -->
    <script type="module" src="src/main.js"></script>
    
    <!-- Inicializar iconos Lucide -->
    <script>
      // Inicializar Lucide icons despu√©s de que se cargue el DOM
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üé® Inicializando iconos Lucide...');
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
          console.log('‚úÖ Iconos Lucide inicializados correctamente');
        } else {
          console.error('‚ùå Lucide no est√° disponible');
        }
      });
      
      // Tambi√©n inicializar cuando se carga la p√°gina completamente
      window.addEventListener('load', function() {
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
          console.log('üîÑ Iconos Lucide reinicializados despu√©s de load');
        }
      });
      
      // Funci√≥n global para reinicializar iconos cuando sea necesario
      window.reinicializarIconos = function() {
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      };
    </script>
  </body>
</html>
