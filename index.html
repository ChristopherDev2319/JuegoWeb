<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Three.js Primera Persona - Disparo</title>
    <link rel="stylesheet" href="css/estilos.css" />
    
    <!-- Import map para resolver m√≥dulos de npm en el navegador -->
    <script type="importmap">
      {
        "imports": {
          "@dimforge/rapier3d-compat": "https://cdn.jsdelivr.net/npm/@dimforge/rapier3d-compat@0.14.0/+esm"
        }
      }
    </script>
  </head>
  <body>
    <!-- ==================== LOBBY SCREEN ==================== -->
    <div id="lobby-screen">
      <!-- Pantalla Inicial del Lobby - Pantalla Completa -->
      <div id="lobby-inicial" class="lobby-pantalla active">
        <div class="lobby-layout">
          <!-- Panel Izquierdo - Perfil y Stats -->
          <div class="lobby-sidebar-left">
            <div class="lobby-card">
              <h3 class="lobby-card-title">Tu Perfil</h3>
              <div class="lobby-seccion">
                <label for="nombre-jugador">Nombre del Jugador</label>
                <div class="input-grupo">
                  <input type="text" id="nombre-jugador" placeholder="Ingresa tu nombre..." maxlength="16">
                  <button id="btn-nombre-aleatorio" class="btn-icono" title="Nombre aleatorio">üé≤</button>
                </div>
                <span id="nombre-error" class="error-mensaje"></span>
              </div>
            </div>
            
            <div class="lobby-card">
              <h3 class="lobby-card-title">Estad√≠sticas</h3>
              <div class="lobby-stats-vertical">
                <div class="stat-row">
                  <span class="stat-row-label">Kills</span>
                  <span class="stat-row-value" id="lobby-kills">0</span>
                </div>
                <div class="stat-row">
                  <span class="stat-row-label">Muertes</span>
                  <span class="stat-row-value" id="lobby-muertes">0</span>
                </div>
                <div class="stat-row">
                  <span class="stat-row-label">K/D Ratio</span>
                  <span class="stat-row-value" id="lobby-kd">0.00</span>
                </div>
                <div class="stat-row">
                  <span class="stat-row-label">Partidas</span>
                  <span class="stat-row-value" id="lobby-partidas">0</span>
                </div>
                <div class="stat-row">
                  <span class="stat-row-label">Victorias</span>
                  <span class="stat-row-value" id="lobby-victorias">0</span>
                </div>
              </div>
            </div>
            
            <!-- Bot√≥n de configuraci√≥n -->
            <button id="btn-config-lobby" class="lobby-btn-config">
              <span>‚öôÔ∏è</span> Configuraci√≥n
            </button>
          </div>
          
          <!-- Panel Central - T√≠tulo y Modos de Juego -->
          <div class="lobby-main">
            <div class="lobby-titulo-container">
              <h1 class="lobby-titulo">FPS ARENA</h1>
              <p class="lobby-titulo-sub">Combate Multijugador</p>
            </div>
            
            <!-- Botones de modo de juego -->
            <div class="lobby-botones" style="width: 100%; max-width: 400px;">
              <button id="btn-modo-local" class="lobby-btn btn-secundario">
                <span class="btn-icono-grande">üéÆ</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Modo Local</span>
                  <span class="btn-desc">Practica sin conexi√≥n</span>
                </span>
              </button>
              <button id="btn-modo-online" class="lobby-btn btn-primario">
                <span class="btn-icono-grande">üåê</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Modo Online</span>
                  <span class="btn-desc">Juega con otros jugadores</span>
                </span>
              </button>
            </div>
          </div>
          
          <!-- Panel Derecho - Info del Juego y Noticias -->
          <div class="lobby-sidebar-right">
            <div class="lobby-card">
              <h3 class="lobby-card-title">Controles</h3>
              <div class="lobby-controls-list">
                <div class="control-hint"><kbd>WASD</kbd> Movimiento</div>
                <div class="control-hint"><kbd>SPACE</kbd> Saltar</div>
                <div class="control-hint"><kbd>E</kbd> Dash</div>
                <div class="control-hint"><kbd>CLICK</kbd> Disparar</div>
                <div class="control-hint"><kbd>RMB</kbd> Apuntar</div>
                <div class="control-hint"><kbd>R</kbd> Recargar</div>
                <div class="control-hint"><kbd>1-8</kbd> Cambiar arma</div>
                <div class="control-hint"><kbd>ESC</kbd> Men√∫ pausa</div>
              </div>
            </div>
            
            <div class="lobby-card">
              <h3 class="lobby-card-title">Jugadores Online</h3>
              <div class="online-status">
                <div class="online-indicator"></div>
                <span class="online-count">-- jugadores</span>
              </div>
            </div>
            
            <div class="lobby-card lobby-tips">
              <h3 class="lobby-card-title">Tip del d√≠a</h3>
              <p class="tip-text">Usa el dash (E) para esquivar balas y moverte r√°pidamente por el mapa. ¬°Tienes 3 cargas!</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Selecci√≥n Online -->
      <div id="lobby-online" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-inicial" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Modo Online</h2>
            </div>
            
            <div class="lobby-botones">
              <button id="btn-partida-publica" class="lobby-btn btn-primario">
                <span class="btn-icono-grande">üîì</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Partida P√∫blica</span>
                  <span class="btn-desc">Matchmaking autom√°tico</span>
                </span>
              </button>
              <button id="btn-partida-privada" class="lobby-btn btn-secundario">
                <span class="btn-icono-grande">üîí</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Partida Privada</span>
                  <span class="btn-desc">Juega con amigos</span>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Pantalla de Opciones Partida Privada -->
      <div id="lobby-privada" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-online" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Partida Privada</h2>
            </div>
            
            <div class="lobby-botones">
              <button id="btn-crear-partida" class="lobby-btn btn-primario">
                <span class="btn-icono-grande">‚ûï</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Crear Partida</span>
                  <span class="btn-desc">Crea una sala nueva</span>
                </span>
              </button>
              <button id="btn-unirse-partida" class="lobby-btn btn-secundario">
                <span class="btn-icono-grande">üö™</span>
                <span class="btn-texto">
                  <span class="btn-titulo">Unirse a Partida</span>
                  <span class="btn-desc">Ingresa c√≥digo de sala</span>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Crear Partida Privada -->
      <div id="lobby-crear" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-privada-crear" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Crear Partida</h2>
            </div>
            
            <div class="lobby-seccion">
              <label for="crear-password">Contrase√±a de la Sala</label>
              <input type="password" id="crear-password" placeholder="4-20 caracteres" maxlength="20">
              <span id="crear-password-error" class="error-mensaje"></span>
            </div>
            
            <button id="btn-confirmar-crear" class="lobby-btn btn-primario btn-full">
              <span>üéØ</span> Crear Partida
            </button>
            
            <span id="crear-error" class="error-mensaje centro"></span>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Unirse a Partida -->
      <div id="lobby-unirse" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-privada-unirse" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Unirse a Partida</h2>
            </div>
            
            <div class="lobby-seccion">
              <label for="unirse-codigo">C√≥digo de Sala</label>
              <input type="text" id="unirse-codigo" placeholder="Ej: ABC123" maxlength="6" style="text-transform: uppercase;">
            </div>
          
            <div class="lobby-seccion">
              <label for="unirse-password">Contrase√±a</label>
              <input type="password" id="unirse-password" placeholder="Contrase√±a de la sala" maxlength="20">
            </div>
            
            <button id="btn-confirmar-unirse" class="lobby-btn btn-primario btn-full">
              <span>üöÄ</span> Unirse
            </button>
            
            <span id="unirse-error" class="error-mensaje centro"></span>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Matchmaking -->
      <div id="lobby-matchmaking" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-cancelar-matchmaking" class="btn-volver">‚Üê Cancelar</button>
              <h2 class="lobby-subtitulo">Buscando Partida</h2>
            </div>
            
            <div class="matchmaking-contenido">
              <div class="matchmaking-spinner"></div>
              <p class="matchmaking-texto" id="matchmaking-estado">Buscando partida...</p>
              <p class="matchmaking-subtexto">Esto puede tomar unos segundos</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pantalla de Sala Creada (Esperando) -->
      <div id="lobby-esperando" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-salir-sala" class="btn-volver">‚Üê Salir</button>
              <h2 class="lobby-subtitulo">Sala Creada</h2>
            </div>
            
            <div class="sala-info">
              <p class="sala-label">C√≥digo de Sala:</p>
              <div class="sala-codigo-container">
                <span id="sala-codigo" class="sala-codigo">------</span>
                <button id="btn-copiar-codigo" class="btn-copiar" title="Copiar c√≥digo">üìã</button>
              </div>
              <p class="sala-hint">Comparte este c√≥digo con tus amigos</p>
            </div>
            
            <div class="sala-jugadores">
              <p class="sala-label">Jugadores: <span id="sala-jugadores-count">1</span>/8</p>
              <div id="sala-jugadores-lista" class="jugadores-lista">
                <!-- Lista de jugadores se llena din√°micamente -->
              </div>
            </div>
            
            <button id="btn-iniciar-partida" class="lobby-btn btn-primario btn-full">
              <span>‚ñ∂Ô∏è</span> Iniciar Partida
            </button>
          </div>
        </div>
      </div>
      
      <!-- Panel de Configuraci√≥n del Lobby -->
      <div id="lobby-config" class="lobby-pantalla">
        <div class="lobby-pantalla-centrada">
          <div class="lobby-container">
            <div class="lobby-header">
              <button id="btn-volver-config" class="btn-volver">‚Üê Volver</button>
              <h2 class="lobby-subtitulo">Configuraci√≥n</h2>
            </div>
            
            <div class="config-lista">
              <div class="config-item">
                <label>Sensibilidad</label>
                <div class="config-control">
                  <input type="range" id="lobby-sensibilidad" min="0.001" max="0.01" step="0.001" value="0.002">
                  <span id="lobby-sensibilidad-valor">0.002</span>
                </div>
              </div>
              
              <div class="config-item">
                <label>Volumen</label>
                <div class="config-control">
                  <input type="range" id="lobby-volumen" min="0" max="1" step="0.1" value="0.5">
                  <span id="lobby-volumen-valor">50%</span>
                </div>
              </div>
              
              <div class="config-item">
                <label>Mostrar FPS</label>
                <input type="checkbox" id="lobby-mostrar-fps">
              </div>
              
              <div class="config-item">
                <label>Crosshair Din√°mico</label>
                <input type="checkbox" id="lobby-crosshair-dinamico" checked>
              </div>
            </div>
            
            <button id="btn-guardar-config" class="lobby-btn btn-primario btn-full">
              <span>üíæ</span> Guardar Configuraci√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ==================== FIN LOBBY SCREEN ==================== -->

    <!-- Pantalla de carga -->
    <div id="loading-screen">
      <div class="loading-content">
        <div class="loading-title">CARGANDO</div>
        <div class="loading-bar-container">
          <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-text" id="loading-text">Iniciando...</div>
      </div>
    </div>

    <!-- Controles ocultos - ver en men√∫ ESC -->
    <div id="info" style="display: none;">
      <div>WASD - Movimiento</div>
      <div>Mouse - Mirar alrededor</div>
      <div>Clic Izquierdo - Disparar</div>
      <div>Clic Derecho - Apuntar</div>
      <div>Espacio - Saltar</div>
      <div>R - Recargar</div>
      <div>E - Dash</div>
      <div>Q / Rueda Mouse - Cambiar arma</div>
      <div>1-8 - Seleccionar arma</div>
    </div>
    <div id="crosshair"></div>
    <div id="aim-indicator">APUNTANDO</div>
    
    <!-- Weapon info -->
    <div id="weapon-info">
      <div id="weapon-name">M4A1</div>
      <div id="ammo">30 / 120</div>
    </div>
    
    <!-- Weapon list -->
    <div id="weapon-list"></div>
    
    <div id="dash-charges">
      <span>DASH: </span>
      <span class="dash-icon"></span>
      <span class="dash-icon"></span>
      <span class="dash-icon"></span>
    </div>
    <div id="damage-indicator"></div>
    
    <!-- Death screen overlay -->
    <div id="death-screen" class="hidden">
      <div class="death-content">
        <div class="death-title">ELIMINADO</div>
        <div class="death-killer">por <span id="killer-name">Jugador</span></div>
        <div class="respawn-countdown">Reapareciendo en <span id="respawn-timer">5</span>s</div>
      </div>
    </div>
    
    <!-- Kill feed -->
    <div id="kill-feed"></div>
    
    <!-- Health bar -->
    <div id="health-bar-container">
      <div id="health-bar"></div>
      <div id="health-text">200 / 200</div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu" class="hidden">
      <div class="pause-overlay"></div>
      <div class="pause-content">
        <div class="pause-buttons">
          <button id="resume-btn" class="pause-btn primary">
            <span class="btn-icon">‚ñ∂</span>
            Continuar
          </button>
          
          <button id="settings-btn" class="pause-btn">
            <span class="btn-icon">‚öô</span>
            Configuraci√≥n
          </button>
          
          <button id="controls-btn" class="pause-btn">
            <span class="btn-icon">üéÆ</span>
            Controles
          </button>
          
          <button id="stats-btn" class="pause-btn">
            <span class="btn-icon">üìä</span>
            Estad√≠sticas
          </button>
          
          <button id="exit-btn" class="pause-btn danger">
            <span class="btn-icon">üö™</span>
            Salir
          </button>
        </div>
        
        <!-- Settings Panel -->
        <div id="settings-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="settings-back-btn" class="back-btn">‚Üê</button>
            <h3>Configuraci√≥n</h3>
          </div>
          <div class="settings-grid">
            <div class="setting-item">
              <label>Sensibilidad</label>
              <input type="range" id="mouse-sensitivity" min="0.001" max="0.01" step="0.001" value="0.002">
              <span id="sensitivity-value">0.002</span>
            </div>
            <div class="setting-item">
              <label>Volumen</label>
              <input type="range" id="master-volume" min="0" max="1" step="0.1" value="0.5">
              <span id="volume-value">50%</span>
            </div>
            <div class="setting-item">
              <label>Mostrar FPS</label>
              <input type="checkbox" id="show-fps">
            </div>
            <div class="setting-item">
              <label>Crosshair Din√°mico</label>
              <input type="checkbox" id="dynamic-crosshair" checked>
            </div>
          </div>
        </div>
        
        <!-- Controls Panel -->
        <div id="controls-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="controls-back-btn" class="back-btn">‚Üê</button>
            <h3>Controles</h3>
          </div>
          <div class="controls-list">
            <div class="control-item"><span>Mover</span><kbd>WASD</kbd></div>
            <div class="control-item"><span>Saltar</span><kbd>SPACE</kbd></div>
            <div class="control-item"><span>Dash</span><kbd>E</kbd></div>
            <div class="control-item"><span>Disparar</span><kbd>CLICK</kbd></div>
            <div class="control-item"><span>Apuntar</span><kbd>RMB</kbd></div>
            <div class="control-item"><span>Recargar</span><kbd>R</kbd></div>
          </div>
        </div>
        
        <!-- Stats Panel -->
        <div id="stats-panel" class="pause-panel hidden">
          <div class="panel-header">
            <button id="stats-back-btn" class="back-btn">‚Üê</button>
            <h3>Estad√≠sticas</h3>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="kills-stat">0</div>
              <div class="stat-label">Kills</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="deaths-stat">0</div>
              <div class="stat-label">Muertes</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="kd-ratio">0.00</div>
              <div class="stat-label">K/D</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="accuracy-stat">0%</div>
              <div class="stat-label">Precisi√≥n</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="shots-fired">0</div>
              <div class="stat-label">Disparos</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="playtime-stat">00:00</div>
              <div class="stat-label">Tiempo</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FPS Counter -->
    <div id="fps-counter" class="hidden">
      <span id="fps-value">60</span> FPS
    </div>

    <!-- Librer√≠as externas de Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.4/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <!-- Configuraci√≥n del juego -->
    <script type="module" src="configuracion-juego.js"></script>

    <!-- Punto de entrada principal del juego -->
    <script type="module" src="src/main.js"></script>
  </body>
</html>
