<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat - Controles Bloqueados</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            background: #333;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover { background: #45a049; }
        .warning {
            background: #ff9800;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Chat - Bloqueo de Controles</h1>
        <p>Verifica que los controles del juego se bloqueen cuando el chat est√° activo</p>
        
        <div class="test-section">
            <h3>üìä Estado del Sistema</h3>
            <div id="status" class="status">Inicializando...</div>
        </div>
        
        <div class="test-section">
            <h3>üéÆ Instrucciones de Prueba</h3>
            <div class="warning">
                <strong>‚ö†Ô∏è C√≥mo probar:</strong>
                <ol>
                    <li>Presiona <strong>T</strong> para abrir el chat</li>
                    <li>Mientras el chat est√© activo, presiona teclas como <strong>E</strong>, <strong>R</strong>, <strong>Q</strong>, <strong>Espacio</strong></li>
                    <li>Verifica que NO se ejecuten las acciones del juego</li>
                    <li>Presiona <strong>Enter</strong> o <strong>Escape</strong> para cerrar el chat</li>
                    <li>Ahora las teclas deber√≠an funcionar normalmente</li>
                </ol>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîß Controles de Prueba</h3>
            <button class="btn" onclick="abrirChat()">Abrir Chat (T)</button>
            <button class="btn" onclick="cerrarChat()">Cerrar Chat</button>
            <button class="btn" onclick="probarTecla('KeyE')">Simular E (Dash)</button>
            <button class="btn" onclick="probarTecla('KeyR')">Simular R (Recarga)</button>
        </div>
        
        <div class="test-section">
            <h3>üìù Log de Eventos</h3>
            <div id="eventLog" class="status" style="height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script type="module">
        import { ChatSystem } from './src/ui/chatSystem.js';
        
        let chat = null;
        let eventLog = [];
        
        // Simular callbacks de controles para testing
        const mockCallbacks = {
            onDash: () => logEvent('üöÄ DASH ejecutado - ¬°Los controles NO est√°n bloqueados!', 'error'),
            onRecargar: () => logEvent('üîÑ RECARGA ejecutada - ¬°Los controles NO est√°n bloqueados!', 'error'),
            onDisparar: () => logEvent('üî´ DISPARO ejecutado - ¬°Los controles NO est√°n bloqueados!', 'error'),
            onSaltar: () => logEvent('‚¨ÜÔ∏è SALTO ejecutado - ¬°Los controles NO est√°n bloqueados!', 'error')
        };
        
        function logEvent(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${message}`);
            updateEventLog();
            
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }
        
        function updateEventLog() {
            const logElement = document.getElementById('eventLog');
            logElement.innerHTML = eventLog.slice(-20).join('<br>'); // Mostrar √∫ltimos 20 eventos
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus() {
            const status = document.getElementById('status');
            const chatActivo = chat ? chat.estaActivo() : false;
            status.innerHTML = `
                Chat: ${chat ? '‚úÖ Inicializado' : '‚ùå No inicializado'} | 
                Estado: ${chatActivo ? 'üî¥ ACTIVO (controles bloqueados)' : 'üü¢ Inactivo (controles libres)'}
            `;
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            chat = new ChatSystem({
                isOnline: false,
                playerName: 'TestPlayer',
                onChatStateChange: (activo) => {
                    logEvent(`Chat ${activo ? 'ACTIVADO' : 'DESACTIVADO'} - Controles ${activo ? 'BLOQUEADOS' : 'LIBRES'}`, activo ? 'success' : 'info');
                    updateStatus();
                }
            });
            
            updateStatus();
            logEvent('Sistema de chat inicializado');
            
            // Simular sistema de controles b√°sico para testing
            document.addEventListener('keydown', (e) => {
                // Solo procesar si el chat NO est√° activo (simula el comportamiento real)
                if (chat && chat.estaActivo()) {
                    logEvent(`Tecla ${e.code} BLOQUEADA (chat activo)`, 'success');
                    return;
                }
                
                // Simular acciones del juego
                switch(e.code) {
                    case 'KeyE':
                        mockCallbacks.onDash();
                        break;
                    case 'KeyR':
                        mockCallbacks.onRecargar();
                        break;
                    case 'Space':
                        mockCallbacks.onSaltar();
                        break;
                }
            });
        });
        
        // Funciones globales para los botones
        window.abrirChat = () => {
            if (chat) {
                chat.abrirChat();
                logEvent('Chat abierto manualmente');
            }
        };
        
        window.cerrarChat = () => {
            if (chat) {
                chat.cerrarChat();
                logEvent('Chat cerrado manualmente');
            }
        };
        
        window.probarTecla = (codigo) => {
            const evento = new KeyboardEvent('keydown', { code: codigo });
            document.dispatchEvent(evento);
            logEvent(`Tecla ${codigo} simulada`);
        };
        
        // Actualizar estado cada segundo
        setInterval(updateStatus, 1000);
    </script>
</body>
</html>