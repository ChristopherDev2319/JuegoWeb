<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sonido Pistola</title>
    <link rel="stylesheet" href="css/estilos.css">
    <style>
        #test-controls {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
        }
        .test-button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover {
            background: #ff8800;
        }
        .test-button:active {
            background: #dd4400;
        }
        #volume-control {
            margin: 20px 0;
        }
        #volume-slider {
            width: 200px;
        }
    </style>
</head>
<body>
    <div id="info">
        <div>üî´ TEST SONIDO PISTOLA</div>
        <div>Prueba el sonido de disparo de la pistola</div>
    </div>
    
    <div id="test-controls">
        <h2>üîä Test Sonido Pistola</h2>
        <p>Haz clic para probar el sonido de disparo</p>
        
        <button class="test-button" id="test-sound">üî´ DISPARAR PISTOLA</button>
        
        <div id="volume-control">
            <label for="volume-slider">Volumen:</label><br>
            <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.4">
            <span id="volume-value">40%</span>
        </div>
        
        <div id="status">Listo para probar</div>
    </div>

    <!-- Librer√≠as externas de Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script type="module">
        import { CONFIG } from './src/config.js';
        import { cargarSonido } from './src/sistemas/sonidos.js';

        let sonidoCargado = false;
        const statusDiv = document.getElementById('status');
        const testButton = document.getElementById('test-sound');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeValue = document.getElementById('volume-value');

        // Actualizar display de volumen
        volumeSlider.addEventListener('input', () => {
            const volume = Math.round(volumeSlider.value * 100);
            volumeValue.textContent = volume + '%';
        });

        // Precargar sonido
        async function precargarSonido() {
            try {
                statusDiv.textContent = 'Cargando sonido...';
                await cargarSonido('sonidos/pistola.mp3');
                sonidoCargado = true;
                statusDiv.textContent = '‚úÖ Sonido cargado - Listo para probar';
                testButton.disabled = false;
            } catch (error) {
                statusDiv.textContent = '‚ùå Error cargando sonido: ' + error.message;
                console.error('Error:', error);
            }
        }

        // Test de sonido
        testButton.addEventListener('click', () => {
            if (!sonidoCargado) {
                statusDiv.textContent = 'Sonido no cargado a√∫n...';
                return;
            }

            const configPistola = CONFIG.armas.PISTOLA;
            const volumen = parseFloat(volumeSlider.value);
            
            // Reproducir sonido directamente
            if (configPistola.sonidoDisparo) {
                const audio = new Audio(configPistola.sonidoDisparo);
                audio.volume = volumen;
                audio.play().then(() => {
                    statusDiv.textContent = `üî´ ¬°BANG! (Volumen: ${Math.round(volumen * 100)}%)`;
                    
                    // Resetear mensaje despu√©s de 1 segundo
                    setTimeout(() => {
                        statusDiv.textContent = '‚úÖ Listo para probar';
                    }, 1000);
                }).catch(error => {
                    statusDiv.textContent = '‚ùå Error reproduciendo: ' + error.message;
                });
            } else {
                statusDiv.textContent = '‚ùå No hay sonido configurado para la pistola';
            }
        });

        // Inicializar
        testButton.disabled = true;
        precargarSonido();

        // Info adicional
        console.log('üî´ Configuraci√≥n de pistola:', CONFIG.armas.PISTOLA);
    </script>
</body>
</html>