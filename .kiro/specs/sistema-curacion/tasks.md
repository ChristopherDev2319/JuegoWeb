# Implementation Plan - Sistema de Curación

- [x] 1. Configurar JuiceBox en config.js
  - Agregar sección `CONFIG.curacion` con modelo, tiempos, posiciones y escalas
  - Agregar animación `healt` a la lista de animaciones en animaciones.js
  - _Requirements: 6.1, 6.2_

- [x] 2. Implementar estado y funciones de curación en armas.js
  - [x] 2.1 Agregar estado `estadoCuracion` con propiedades necesarias
    - juiceBoxEquipado, armaPreviaACuracion, curacionEnProgreso, tiempoInicioCuracion
    - _Requirements: 1.1, 2.1, 3.1_
  - [x] 2.2 Implementar función `cargarModeloJuiceBox` para cargar el modelo GLB
    - Cargar modelo stylized_juicebox.glb
    - Aplicar escala y posición FPS
    - _Requirements: 1.4, 6.1_
  - [x] 2.3 Implementar función `alternarJuiceBox` para equipar/desequipar con tecla C
    - Toggle entre JuiceBox y arma/cuchillo anterior
    - Ocultar arma/cuchillo cuando JuiceBox está equipado
    - _Requirements: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3_
  - [x] 2.4 Implementar función `iniciarCuracion` para comenzar el proceso de curación
    - Verificar que JuiceBox está equipado
    - Iniciar timer de 2 segundos
    - _Requirements: 3.1_
  - [x] 2.5 Implementar función `actualizarCuracion` para manejar el timer y aplicar curación
    - Verificar si pasaron 2 segundos
    - Aplicar 50 HP sin exceder vida máxima
    - _Requirements: 3.2, 3.5_
  - [x] 2.6 Implementar función `cancelarCuracion` para interrumpir la curación
    - Resetear estado sin aplicar curación
    - _Requirements: 3.3_
  - [x] 2.7 Implementar bloqueo de apuntado cuando JuiceBox está equipado
    - Modificar `alternarApuntado` para verificar si JuiceBox está equipado
    - _Requirements: 4.1_
  - [x] 2.8 Implementar desequipamiento automático al cambiar de arma
    - Modificar funciones de cambio de arma para desequipar JuiceBox
    - _Requirements: 2.4_
  - [ ]* 2.9 Write property test: Toggle de Equipamiento JuiceBox
    - **Property 1: Toggle de Equipamiento JuiceBox**
    - **Validates: Requirements 1.1, 1.2, 1.3**
  - [ ]* 2.10 Write property test: Exclusividad Mutua de Equipamiento
    - **Property 2: Exclusividad Mutua de Equipamiento**
    - **Validates: Requirements 2.1, 2.2, 2.3**

- [x] 3. Integrar con sistema de controles
  - [x] 3.1 Agregar callback `onAlternarJuiceBox` en controles.js
    - Manejar tecla C para alternar JuiceBox
    - _Requirements: 1.1_
  - [x] 3.2 Integrar callback en main.js
    - Conectar callback con función alternarJuiceBox
    - _Requirements: 1.1_
  - [x] 3.3 Modificar manejo de clic izquierdo para iniciar curación
    - Si JuiceBox equipado, llamar iniciarCuracion en lugar de disparar
    - _Requirements: 3.1_
  - [ ]* 3.4 Write property test: Bloqueo de Apuntado con JuiceBox
    - **Property 6: Bloqueo de Apuntado con JuiceBox**
    - **Validates: Requirements 4.1**

- [x] 4. Checkpoint - Verificar funcionalidad FPS
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Implementar JuiceBox en JugadorRemoto para TPS
  - [x] 5.1 Agregar configuración JUICEBOX_TPS_CONFIG
    - Definir modelo, escala, offsets de posición y rotación
    - _Requirements: 6.1, 6.2_
  - [x] 5.2 Implementar función `cargarJuiceBoxTPS` para cargar y parentear modelo
    - Cargar modelo y parentear al hueso de la mano
    - Mantener oculto inicialmente
    - _Requirements: 5.1, 6.1, 6.3_
  - [x] 5.3 Implementar función `actualizarVisibilidadJuiceBox` para mostrar/ocultar
    - Ocultar armas y cuchillo cuando JuiceBox visible
    - _Requirements: 5.1, 5.4_
  - [x] 5.4 Agregar animación `healt` al sistema de animaciones
    - Cargar healt_tps.glb
    - Configurar duración de 2 segundos
    - _Requirements: 5.2_
  - [x] 5.5 Implementar función `procesarCuracion` para manejar eventos de curación
    - Mostrar JuiceBox y reproducir animación healt
    - Restaurar animación idle/walk al terminar
    - _Requirements: 5.2, 5.3_

- [x] 6. Integrar con sistema de red
  - [x] 6.1 Agregar emisión de eventos healStart/healCancel en cliente
    - Emitir cuando inicia o cancela curación
    - _Requirements: 5.1_
  - [x] 6.2 Agregar manejo de evento playerHealing en servidor
    - Broadcast a otros jugadores cuando alguien cura
    - _Requirements: 5.1_
  - [x] 6.3 Agregar recepción de evento playerHealing en cliente
    - Llamar procesarCuracion en JugadorRemoto correspondiente
    - _Requirements: 5.1, 5.2_
  - [ ]* 6.4 Write property test: Curación Respeta Límites de Vida
    - **Property 4: Curación Respeta Límites de Vida**
    - **Validates: Requirements 3.2, 3.5**
  - [ ]* 6.5 Write property test: Interrupción Cancela Curación Sin Efecto
    - **Property 5: Interrupción Cancela Curación Sin Efecto**
    - **Validates: Requirements 3.3**

- [x] 7. Integrar actualización de curación en game loop
  - [x] 7.1 Llamar actualizarCuracion en el loop principal de main.js
    - Actualizar cada frame
    - Aplicar curación cuando se complete
    - _Requirements: 3.2_
  - [x] 7.2 Agregar UI feedback de progreso de curación
    - Mostrar barra de progreso o indicador visual
    - _Requirements: 3.1_
  - [ ]* 7.3 Write property test: Bloqueo Durante Curación
    - **Property 7: Bloqueo Durante Curación**
    - **Validates: Requirements 3.4**

- [x] 8. Final Checkpoint - Verificar sistema completo
  - Ensure all tests pass, ask the user if questions arise.
